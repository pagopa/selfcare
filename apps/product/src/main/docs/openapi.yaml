---
openapi: 3.1.0
tags:
- name: Product
- name: external-pnpg
- name: external-v2
components:
  schemas:
    AttachmentTemplate:
      type: object
      properties:
        templatePath:
          type: string
        templateVersion:
          type: string
        name:
          type: string
        mandatory:
          type: boolean
        generated:
          type: boolean
        workflowType:
          type: array
          items:
            $ref: "#/components/schemas/WorkflowType"
        workflowState:
          $ref: "#/components/schemas/OnboardingStatus"
        order:
          type: integer
          format: int32
    BackOfficeConfigurations:
      type: object
      properties:
        url:
          type: string
        identityTokenAudience:
          type: string
    ContractTemplate:
      type: object
      properties:
        contractTemplatePath:
          type: string
        contractTemplateVersion:
          type: string
        attachments:
          type: array
          items:
            $ref: "#/components/schemas/AttachmentTemplate"
    EmailTemplate:
      type: object
      properties:
        path:
          type: string
        version:
          type: string
        status:
          $ref: "#/components/schemas/OnboardingStatus"
    Instant:
      type: string
      format: date-time
      examples:
      - 2022-03-10T16:15:50Z
    InstitutionType:
      type: string
      enum:
      - PA
      - PG
      - GSP
      - SA
      - PT
      - SCP
      - PSP
      - AS
      - REC
      - CON
      - PRV
      - PRV_PF
      - GPU
      - SCEC
    JsonValue:
      type: object
      properties:
        valueType:
          $ref: "#/components/schemas/ValueType"
    OnboardingStatus:
      type: string
      enum:
      - REQUEST
      - TOBEVALIDATED
      - PENDING
      - COMPLETED
      - FAILED
      - REJECTED
      - DELETED
    Origin:
      type: string
      enum:
      - IPA
      - SELC
      - ANAC
      - ADE
      - INFOCAMERE
      - IVASS
      - PDND_INFOCAMERE
    Problem:
      type: object
      properties:
        detail:
          type: string
        instance:
          type: string
        status:
          type: integer
          format: int32
        title:
          type: string
        type:
          type: string
    ProductBaseResponse:
      type: object
      properties:
        id:
          type: string
        productId:
          type: string
        status:
          $ref: "#/components/schemas/ProductStatus"
    ProductCreateRequest:
      type: object
      properties:
        alias:
          type: string
        productId:
          type: string
          pattern: \S
        allowedInstitutionTaxCode:
          type: array
          items:
            type: string
        backOfficeEnvironmentConfigurations:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/BackOfficeConfigurations"
        consumers:
          type: array
          items:
            type: string
        createdAt:
          $ref: "#/components/schemas/Instant"
        createdBy:
          type: string
        delegable:
          type: boolean
        depictImageUrl:
          type: string
        description:
          type: string
          pattern: \S
        emailTemplates:
          type: object
          additionalProperties:
            type: object
            additionalProperties:
              type: array
              items:
                $ref: "#/components/schemas/EmailTemplate"
        enabled:
          type: boolean
        expirationDate:
          type: integer
          format: int32
        identityTokenAudience:
          type: string
        logo:
          type: string
        logoBgColor:
          type: string
          pattern: "^#([A-Fa-f0-9]{6})$"
        roleMappings:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/UserRolePermission"
        status:
          $ref: "#/components/schemas/ProductStatus"
        title:
          type: string
          pattern: \S
        urlBO:
          type: string
        urlPublic:
          type: string
        institutionAggregatorContractMappings:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/ContractTemplate"
        institutionContractMappings:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/ContractTemplate"
        userAggregatorContractMappings:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/ContractTemplate"
        userContractMappings:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/ContractTemplate"
        invoiceable:
          type: boolean
        version:
          type: integer
          format: int32
      required:
      - productId
      - description
      - title
    ProductOriginResponse:
      type: object
      properties:
        origins:
          type: array
          items:
            $ref: "#/components/schemas/ProductOrigins"
    ProductOrigins:
      type: object
      properties:
        institutionType:
          $ref: "#/components/schemas/InstitutionType"
        origin:
          $ref: "#/components/schemas/Origin"
        labelKey:
          type: string
    ProductResponse:
      type: object
      properties:
        alias:
          type: string
        productId:
          type: string
          pattern: \S
        allowedInstitutionTaxCode:
          type: array
          items:
            type: string
        backOfficeEnvironmentConfigurations:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/BackOfficeConfigurations"
        consumers:
          type: array
          items:
            type: string
        createdAt:
          $ref: "#/components/schemas/Instant"
        createdBy:
          type: string
        delegable:
          type: boolean
        depictImageUrl:
          type: string
        description:
          type: string
          pattern: \S
        emailTemplates:
          type: object
          additionalProperties:
            type: object
            additionalProperties:
              type: array
              items:
                $ref: "#/components/schemas/EmailTemplate"
        enabled:
          type: boolean
        expirationDate:
          type: integer
          format: int32
        identityTokenAudience:
          type: string
        logo:
          type: string
        logoBgColor:
          type: string
          pattern: "^#([A-Fa-f0-9]{6})$"
        roleMappings:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/UserRolePermission"
        status:
          $ref: "#/components/schemas/ProductStatus"
        title:
          type: string
          pattern: \S
        urlBO:
          type: string
        urlPublic:
          type: string
        institutionAggregatorContractMappings:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/ContractTemplate"
        institutionContractMappings:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/ContractTemplate"
        userAggregatorContractMappings:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/ContractTemplate"
        userContractMappings:
          type: object
          additionalProperties:
            $ref: "#/components/schemas/ContractTemplate"
        invoiceable:
          type: boolean
        version:
          type: integer
          format: int32
        id:
          type: string
      required:
      - productId
      - description
      - title
    ProductRole:
      type: object
      properties:
        code:
          type: string
        label:
          type: string
        productLabel:
          type: string
        description:
          type: string
    ProductStatus:
      type: string
      enum:
      - TESTING
      - ACTIVE
      - DELETED
      - SUSPEND
    UserRolePermission:
      type: object
      properties:
        multiroleAllowed:
          type: boolean
        skipUserCreation:
          type: boolean
        phasesAdditionAllowed:
          type: array
          items:
            type: string
        roles:
          type: array
          items:
            $ref: "#/components/schemas/ProductRole"
    ValueType:
      type: string
      enum:
      - ARRAY
      - OBJECT
      - STRING
      - NUMBER
      - "TRUE"
      - "FALSE"
      - "NULL"
    WorkflowType:
      type: string
      enum:
      - CONTRACT_REGISTRATION
      - FOR_APPROVE
      - FOR_APPROVE_PT
      - FOR_APPROVE_GPU
      - CONFIRMATION
      - USERS
      - USERS_IMPORT
      - IMPORT
      - IMPORT_AGGREGATION
      - CONTRACT_REGISTRATION_AGGREGATOR
      - CONFIRMATION_AGGREGATE
      - INCREMENT_REGISTRATION_AGGREGATOR
      - CONFIRMATION_AGGREGATOR
      - USERS_PG
      - USERS_EA
  securitySchemes:
    SecurityScheme:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Authentication
paths:
  /product:
    post:
      summary: Create or update a product configuration (upsert)
      description: Creates a new product configuration or updates the existing one
        when a match is found
      operationId: createProduct
      tags:
      - Product
      - external-v2
      - external-pnpg
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductCreateRequest"
        required: true
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductBaseResponse"
        "400":
          description: Bad Request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "500":
          description: Internal Server Error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme: []
  /product/ping:
    get:
      summary: Ping endpoint
      operationId: ping
      tags:
      - Product
      responses:
        "200":
          description: OK
          content:
            application/problem+json:
              schema:
                type: string
        "500":
          description: Internal Server Error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme: []
  /product/{productId}:
    patch:
      summary: Partially update a product by ID (JSON Merge Patch)
      description: Applies a JSON Merge Patch document to partially update an existing
        product identified by its productId.
      operationId: patchProductById
      tags:
      - Product
      - external-v2
      - external-pnpg
      parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/merge-patch+json:
            schema:
              $ref: "#/components/schemas/JsonValue"
        required: true
      responses:
        "200":
          description: Product successfully patched
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductBaseResponse"
        "400":
          description: "Bad Request - Invalid patch document, invalid productId, or\
            \ field constraint violation"
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "404":
          description: Not Found - No product found with the specified productId
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "500":
          description: Internal Server Error - Unexpected error occurred while applying
            the patch
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme: []
    get:
      summary: Get product by productId
      description: Retrieve a product by its unique identifier.
      operationId: getProductById
      tags:
      - Product
      - external-v2
      - external-pnpg
      parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Product found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductResponse"
        "404":
          description: Product not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "500":
          description: Internal Server Error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme: []
    delete:
      summary: Cancel product by ID
      description: Marks the product as DELETED if it exists.
      operationId: deleteProductById
      tags:
      - Product
      - external-v2
      - external-pnpg
      parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Product cancelled
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductBaseResponse"
        "400":
          description: Bad request
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "404":
          description: Product not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "500":
          description: Internal Server Error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme: []
  /product/{productId}/origins:
    get:
      summary: Get product origins by productId
      description: Retrieve the list of institution origins for the given product.
      operationId: getProductOriginsById
      tags:
      - Product
      - external-v2
      - external-pnpg
      parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Origins found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductOriginResponse"
        "404":
          description: Product not found
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "500":
          description: Internal Server Error
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Problem"
        "401":
          description: Not Authorized
        "403":
          description: Not Allowed
      security:
      - SecurityScheme: []
info:
  title: Product API
  version: 1.0.0
servers:
- url: http://localhost:8080
  description: Auto generated value
- url: http://0.0.0.0:8080
  description: Auto generated value
